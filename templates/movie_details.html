{% extends "base.html" %}

{% block title %}{{ movie.title }} - Movie Recommender{% endblock %}

{% block content %}
<div class="glass-panel" style="margin-top: 20px; border: none; background: transparent;">
    {% if user %}
    <a href="javascript:history.back()" class="btn-secondary">‚Üê Back</a>
    {% else %}
    <a href="/" class="btn-secondary">‚Üê Back to Home</a>
    {% endif %}
</div>

<div class="glass-panel">
    <div class="details-flex">
        <!-- Left: Poster -->
        <div class="poster-section">
            <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="poster-img">

            {% if user %}
            <!-- Library Actions -->
            <div class="library-box">
                <h4 style="margin-bottom: 10px;">Your Library</h4>
                <div class="library-actions">
                    <button onclick="toggleBookmark('{{ movie.id }}', '{{ movie.title|escape }}', 'to_watch')"
                        class="btn-primary {% if bookmark_status == 'to_watch' %}bg-gradient-primary{% else %}bg-transparent-secondary{% endif %}"
                        id="btn-to-watch" style="flex: 1;">
                        üìå To Watch
                    </button>
                    <button onclick="toggleBookmark('{{ movie.id }}', '{{ movie.title|escape }}', 'watched')"
                        class="btn-primary {% if bookmark_status == 'watched' %}bg-gradient-primary{% else %}bg-transparent-secondary{% endif %}"
                        id="btn-watched" style="flex: 1;">
                        ‚úÖ Watched
                    </button>
                    {% if bookmark_status %}
                    <button onclick="removeBookmark('{{ movie.id }}')" class="btn-danger">‚ùå</button>
                    {% endif %}
                </div>

                <h4 style="margin-bottom: 5px;">Your Rating</h4>
                <div class="rating-box">
                    <input type="range" id="rating-slider" min="0" max="10" step="0.5"
                        value="{{ user_rating | default(0) }}" style="flex: 1;">
                    <span id="rating-value" style="font-weight: bold; width: 40px;">{{ user_rating | default(0)
                        }}</span>
                    <button onclick="saveRating('{{ movie.id }}', '{{ movie.title|escape }}')"
                        class="btn-secondary">Save</button>
                </div>
            </div>
            {% else %}
            <div class="guest-prompt">
                <p style="margin: 0;">üí° <a href="/login" style="color: #7c3aed; font-weight: bold;">Login</a> to
                    bookmark and rate movies!</p>
            </div>
            {% endif %}
        </div>

        <!-- Right: Details -->
        <div class="info-section">
            <h1 class="movie-title-large">{{ movie.title }}</h1>
            {% if movie.tagline %}
            <p style="font-style: italic; color: #a0a0a0; font-size: 1.1rem;">{{ movie.tagline }}</p>
            {% endif %}

            <div style="margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <span class="rating-badge">IMDb {{ movie.vote_average_formatted }}</span>
                <span>{{ movie.release_date_formatted }}</span>
                <span>{{ movie.runtime }} min</span>
            </div>

            <div style="margin-bottom: 25px;">
                {% for genre in movie.genres %}
                <span class="genre-tag">{{ genre }}</span>
                {% endfor %}
            </div>

            <h3>Overview</h3>
            <p style="line-height: 1.6; color: #e0e0e0; margin-bottom: 30px;">
                {{ movie.overview }}
            </p>

            <div class="glass-panel info-panel-inner">
                <div class="stats-grid">
                    <div>
                        <strong>Budget:</strong> ${{ movie.budget_formatted }}<br>
                        <strong>Revenue:</strong> ${{ movie.revenue_formatted }}<br>
                        <strong>Status:</strong> {{ movie.status }}
                    </div>
                    <div>
                        <strong>Original Language:</strong> {{ movie.original_language|upper }}<br>
                        <strong>Director/Crew:</strong> {{ movie.crew[:3]|join(', ') }}<br>
                        <strong>Production:</strong> {{ movie.production_companies[:2]|join(', ') }}
                    </div>
                </div>
                <div style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                    <strong>Cast:</strong> {{ movie.cast[:10]|join(', ') }}
                </div>
            </div>
        </div>
    </div>
</div>


<hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 40px 0;">

<h3>üé¨ You Might Also Like</h3>
<div class="grid-container">
    {% for rec in recommendations %}
    <div class="movie-card">
        <a href="/movie/{{ rec.id }}">
            <img src="{{ rec.poster_url }}" class="movie-poster" alt="{{ rec.title }}">
            <div class="movie-info">
                <div class="title-text" title="{{ rec.title }}">{{ rec.title }}</div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span class="subtitle-text">{{ rec.year }}</span>
                    <span class="rating-badge">‚òÖ {{ rec.vote_average_formatted }}</span>
                </div>
            </div>
        </a>
    </div>
    {% else %}
    <p>No recommendations available.</p>
    {% endfor %}
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/main.js"></script>
{% endblock %}